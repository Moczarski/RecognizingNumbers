<!DOCTYPE html>
<html>

<head>
    <title>Mateusz Moczarski AI</title>
	
	<script src="https://unpkg.com/brain.js"></script>
		
    <script>
        function draw(el) {
            const pixel = 10
            const ctx = el.getContext('2d')
            let x = []
            let y = []
            let moves = []
            let isPainting = false

            const clear = () => ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height)

            const addPoint = (_x, _y, isMoving) => {
                x.push(_x)
                y.push(_y)
                moves.push(isMoving)
            }

            const redraw = () => {
                clear()

                ctx.strokeStyle = 'red'
                ctx.lineJoin = 'round'
                ctx.lineWidth = pixel

                for (let i = 0; i < moves.length; i++) {
                    ctx.beginPath()
                    if (moves[i] && i) {
                        ctx.moveTo(x[i - 1], y[i - 1])
                    } else {
                        ctx.moveTo(x[i] - 1, y[i])
                    }
                    ctx.lineTo(x[i], y[i])
                    ctx.closePath()
                    ctx.stroke()
                }
            }

            this.reset = () => {
                isPainting = false
                x = []
                y = []
                moves = []
                clear()
            }

            this.getVector = () => {
                const w = el.clientWidth
                const h = el.clientHeight
                const p = el.clientWidth / pixel
                const xStep = w / p
                const yStep = h / p
                const vector = []
                for(let x = 0; x < w; x += xStep) {
                    for(let y = 0; y < h; y += yStep) {
                        const data = ctx.getImageData(x, y, xStep, yStep)

                        let nonEmptyPixelsCount = 0
                        for(let i = 0; i < data.data.length; i += 4) {
                            const isEmpty = data.data[i] === 0
                            if (!isEmpty) {
                                nonEmptyPixelsCount += 1
                            }
                        }

                        vector.push(nonEmptyPixelsCount > 1 ? 1 : 0)
                    }
                }
                return vector
            }

            el.addEventListener('mousedown', event => {
                const bounds = event.target.getBoundingClientRect()
                const x = event.clientX - bounds.left
                const y = event.clientY - bounds.top
                isPainting = true
                addPoint(x, y, false)
                redraw()
            })

            el.addEventListener('mousemove', event => {
                const bounds = event.target.getBoundingClientRect()
                const x = event.clientX - bounds.left
                const y = event.clientY - bounds.top
                if (isPainting) {
                    addPoint(x, y, true)
                    redraw()
                }
            })

            el.addEventListener('mouseup', () => {isPainting = false})

            el.addEventListener('mouseleave', () => {isPainting = false})
        }
    </script>
	
	<style>
	
		th {
			font-size: 5vh;
		}
		
		body {
			background-color: #000F;
		}
		
		div {
			background-color: #DDDF;
			width: 50vw;
			position: relative;
			left: 23vw;
		}
		
		#info {
			font-size: 3vh;
			color: red;
		}
		
		p {
			font-size: 3vh;
		}
		
		span {
			font-size: 3vh;
		}
		
		#train {			
			background-color: black;
			border: none;
			color: white;
			padding: 15px 32px;
			text-align: center;
			text-decoration: none;
			display: inline-block;
			font-size: 16px;
			transition-duration: 0.4s;
		}
		
		#train:hover {
			background-color: #FFFF;
			color: black;
		}
		
		#recognize {
			background-color: black;
			border: none;
			color: white;
			padding: 15px 32px;
			text-align: center;
			text-decoration: none;
			display: inline-block;
			font-size: 16px;
			transition-duration: 0.4s;
		}
		
		#recognize:hover {
			background-color: #FFFF;
			color: black;
		}
		
		#result {
			font-size: 5vh;
			color: red;
		}
	
	</style>
</head>

<body>

	<div>
		
		<table align="center" cellspacing="0" cellpadding="10" border="2">
		
			<caption>
				<h2>DRAW DIGITS</h2>
			</caption>
			
			<tr>
				<th>0</th>
				<td>
					<canvas id="p1" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
				<td>
					<canvas id="p2" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
				<td>
					<canvas id="p3" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
			</tr>
			<tr>
				<th>1</th>
				<td>
					<canvas id="n1" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
				<td>
					<canvas id="n2" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
				<td>
					<canvas id="n3" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
			</tr>
			<tr>
				<th>2</th>
				<td>
					<canvas id="a1" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
				<td>
					<canvas id="a2" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
				<td>
					<canvas id="a3" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
			</tr>
			<tr>
				<th>3</th>
				<td>
					<canvas id="b1" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
				<td>
					<canvas id="b2" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
				<td>
					<canvas id="b3" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
			</tr>
			<tr>
				<th>4</th>
				<td>
					<canvas id="c1" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
				<td>
					<canvas id="c2" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
				<td>
					<canvas id="c3" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
			</tr>
			<tr>
				<th>5</th>
				<td>
					<canvas id="d1" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
				<td>
					<canvas id="d2" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
				<td>
					<canvas id="d3" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
			</tr>
			<tr>
				<th>6</th>
				<td>
					<canvas id="e1" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
				<td>
					<canvas id="e2" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
				<td>
					<canvas id="e3" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
			</tr>
			<tr>
				<th>7</th>
				<td>
					<canvas id="f1" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
				<td>
					<canvas id="f2" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
				<td>
					<canvas id="f3" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
			</tr>
			<tr>
				<th>8</th>
				<td>
					<canvas id="g1" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
				<td>
					<canvas id="g2" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
				<td>
					<canvas id="g3" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
			</tr>
			<tr>
				<th>9</th>
				<td>
					<canvas id="h1" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
				<td>
					<canvas id="h2" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
				<td>
					<canvas id="h3" width="200" height="200" style="border: 1px solid black; cursor: default; display: block;"></canvas>
				</td>
			</tr>
			
		</table>

		<table width="100%" align="center">
		
			<caption><br /><br />
				<button id="train">TRAIN</button><br />
			</caption>
			
			<tr>
				<td align="center">
					<table>
						<tbody id="res">
							<tr>
								<th id="info">Error: </th>
								<td id="err"></td>
							</tr>
							<tr>
								<th id="info">Repetitions: </th>
								<td id="iterations"></td>
							</tr>
						</tbody>
					</table>
				</td>
			</tr>
		</table>

			<table align="center">
				<hr />
				<tr>
					<td align="center">
						<canvas id="g" width="200" height="200" style="border: 5px solid black; cursor: default; display: block;"></canvas>
					</td>
				</tr>
			</table>
			<table align="center">
				<caption>
					<span>RESULT: </span>
					<span id="result"></span>
				</caption>
				<caption>
					<button id="recognize">RECOGNIZE DIGITS</button>
				</caption>
			</table>
			
	</div>
	
		<script>
		
			const pc1 = new draw(document.getElementById('p1'))
			const pc2 = new draw(document.getElementById('p2'))
			const pc3 = new draw(document.getElementById('p3'))
			const nc1 = new draw(document.getElementById('n1'))
			const nc2 = new draw(document.getElementById('n2'))
			const nc3 = new draw(document.getElementById('n3'))
			const ac1 = new draw(document.getElementById('a1'))
			const ac2 = new draw(document.getElementById('a2'))
			const ac3 = new draw(document.getElementById('a3'))
			const bc1 = new draw(document.getElementById('b1'))
			const bc2 = new draw(document.getElementById('b2'))
			const bc3 = new draw(document.getElementById('b3'))
			const cc1 = new draw(document.getElementById('c1'))
			const cc2 = new draw(document.getElementById('c2'))
			const cc3 = new draw(document.getElementById('c3'))
			const dc1 = new draw(document.getElementById('d1'))
			const dc2 = new draw(document.getElementById('d2'))
			const dc3 = new draw(document.getElementById('d3'))
			const ec1 = new draw(document.getElementById('e1'))
			const ec2 = new draw(document.getElementById('e2'))
			const ec3 = new draw(document.getElementById('e3'))
			const fc1 = new draw(document.getElementById('f1'))
			const fc2 = new draw(document.getElementById('f2'))
			const fc3 = new draw(document.getElementById('f3'))
			const gc1 = new draw(document.getElementById('g1'))
			const gc2 = new draw(document.getElementById('g2'))
			const gc3 = new draw(document.getElementById('g3'))
			const hc1 = new draw(document.getElementById('h1'))
			const hc2 = new draw(document.getElementById('h2'))
			const hc3 = new draw(document.getElementById('h3'))
			const gc = new draw(document.getElementById('g'))

			const net = new brain.NeuralNetwork()

			train.addEventListener('click', () => {
				const data = []

				data.push({ input: pc1.getVector(), output: {0: 1} })
				data.push({ input: pc2.getVector(), output: {0: 1} })
				data.push({ input: pc3.getVector(), output: {0: 1} })
				data.push({ input: nc1.getVector(), output: {1: 1} })
				data.push({ input: nc2.getVector(), output: {1: 1} })
				data.push({ input: nc3.getVector(), output: {1: 1} })
				data.push({ input: ac1.getVector(), output: {2: 1} })
				data.push({ input: ac2.getVector(), output: {2: 1} })
				data.push({ input: ac3.getVector(), output: {2: 1} })
				data.push({ input: bc1.getVector(), output: {3: 1} })
				data.push({ input: bc2.getVector(), output: {3: 1} })
				data.push({ input: bc3.getVector(), output: {3: 1} })
				data.push({ input: cc1.getVector(), output: {4: 1} })
				data.push({ input: cc2.getVector(), output: {4: 1} })
				data.push({ input: cc3.getVector(), output: {4: 1} })
				data.push({ input: dc1.getVector(), output: {5: 1} })
				data.push({ input: dc2.getVector(), output: {5: 1} })
				data.push({ input: dc3.getVector(), output: {5: 1} })
				data.push({ input: ec1.getVector(), output: {6: 1} })
				data.push({ input: ec2.getVector(), output: {6: 1} })
				data.push({ input: ec3.getVector(), output: {6: 1} })
				data.push({ input: fc1.getVector(), output: {7: 1} })
				data.push({ input: fc2.getVector(), output: {7: 1} })
				data.push({ input: fc3.getVector(), output: {7: 1} })
				data.push({ input: gc1.getVector(), output: {8: 1} })
				data.push({ input: gc2.getVector(), output: {8: 1} })
				data.push({ input: gc3.getVector(), output: {8: 1} })
				data.push({ input: hc1.getVector(), output: {9: 1} })
				data.push({ input: hc2.getVector(), output: {9: 1} })
				data.push({ input: hc3.getVector(), output: {9: 1} })

				const result = net.train(data, {log: true})
				err.innerHTML = result.error
				iterations.innerHTML = result.iterations
				res.removeAttribute('style')
			})

			recognize.addEventListener('click', () => {
				const result = brain.likely(gc.getVector(), net)
				document.getElementById('result').innerHTML = result
				gc.reset()
			})
		</script>
		
	</body>
	
</html>